# 中国暗棋（揭棋）Web版人机对战工具

基于现有中国暗棋AI引擎的单机网页人机对战工具，支持完整的暗棋游戏规则和AI辅助功能。

## 功能特性

### 🎮 核心游戏功能
- **完整的9×10象棋棋盘**：标准暗棋布局，UI简洁直观
- **棋盘方向切换**：支持"我执红先"和"我执黑先"两种视角
- **暗子身份指定**：点击暗子可手动指定其真实身份（阵营+棋种）
- **智能走子交互**：选中棋子后高亮可走格，非法走子会给出友好提示
- **完整历史记录**：支持悔棋/重做，完整的走子历史回放

### 🤖 AI辅助功能
- **AI推荐走法**：调用现有AI引擎计算最佳走法
- **详细推荐信息**：显示起点、终点、棋子类型、是否吃子、估值等

### 📋 游戏规则
- **标准暗棋规则**：与中国象棋棋盘相同，棋子分暗子与明子
- **暗子机制**：背面朝上，位置随机（帅/将为明子）
- **走法规则**：暗子按所在格原始棋种走法，走后必须翻成明子
- **吃子规则**：暗子可以吃子被吃，被吃暗子保持背面朝上
- **明子规则**：按中国象棋常规走法，相/象与仕/士允许过河

## 安装和运行

### 环境要求
- Python 3.7+
- 现代浏览器（Chrome、Firefox、Safari、Edge等）

### 手动启动（开发模式）
```bash
python app.py
```

## 使用说明

### 基本操作
1. **开始游戏**：页面加载后会自动初始化游戏，红方先行
2. **移动棋子**：点击己方棋子选中，再点击目标位置移动
3. **查看可走位置**：选中棋子后，合法移动位置会高亮显示
4. **取消选择**：再次点击已选中的棋子可取消选择

### 暗子身份编辑
1. 点击任意暗子（显示为"暗"的棋子）
2. 在右侧面板选择对应的棋子类型
3. 暗子身份会立即更新并显示对应棋子

### AI功能使用
1. **获取AI推荐**：点击"AI提示"按钮
2. **查看推荐详情**：右侧面板会显示详细的推荐信息
3. **执行推荐**：点击"执行AI推荐"自动执行AI建议的走法

### 游戏控制
- **新游戏**：重新开始游戏
- **悔棋**：撤销上一步棋
- **重做**：重新执行被撤销的棋步
- **翻转棋盘**：改变棋盘显示方向

## 文件结构

```
web/
├── index.html          # 主页面HTML
├── style.css          # 样式文件
├── game.js            # 前端游戏逻辑
├── app.py             # 后端Flask服务器
└── README.md          # 说明文档
```

## 技术架构

### 前端
- **HTML5/CSS3**：响应式界面设计
- **原生JavaScript**：游戏逻辑和用户交互
- **Grid布局**：棋盘布局和组件排列

### 后端
- **Flask**：轻量级Web框架
- **现有AI引擎**：集成musesfish_pvs引擎
- **RESTful API**：前后端通信接口

## 游戏规则详解

### 暗子机制
- **初始布局**：除帅/将外，所有棋子都是暗子
- **翻子规则**：暗子首次移动时必须翻开成对应明子
- **位置映射**：暗子的走法取决于其所在位置的原始棋种

### 特殊规则
- **暗子走法**：按所在格在标准象棋中的棋子类型走
- **翻子限制**：暗子一旦翻开就不能再变回暗子
- **吃子机制**：被吃的暗子身份对对方保密
- **过河规则**：相/象与仕/士在此变体中允许过河

### 胜负判定
- **将死**：对方帅/将被吃掉
- **困毙**：己方无合法走法且被将军

## 常见问题

### Q: AI不工作怎么办？
A: 确保以下文件存在且路径正确：
- `../board/board.py`
- `../board/common_20210604_fixed.py`
- `../musesfish_pvs_20210604_fixed.py`

### Q: 如何修改AI搜索深度？
A: 在`app.py`中修改`get_ai_recommendation`方法中的时间限制和搜索参数。

### Q: 能否支持联机对战？
A: 当前版本仅支持单机人机对战，后续版本可考虑添加联机功能。

### Q: 如何自定义棋盘样式？
A: 编辑`style.css`文件中的`.chess-board`和相关样式类。

## 开发说明

### 添加新功能
1. 前端功能：修改`game.js`中的`JieqiGame`类
2. 后端API：在`app.py`中添加新的路由处理器
3. 界面样式：更新`style.css`和`index.html`

### 调试模式
启动时添加调试参数：
```bash
python app.py
```
这将启用Flask的调试模式，代码修改会自动重载。

### API接口文档
- `POST /api/ai-recommendation`：获取AI推荐走法
- `POST /api/validate-move`：验证走法合法性
- `GET /api/game-status`：获取游戏状态

## 致谢

本项目基于以下开源项目：
- [elephantfish](https://github.com/bupticybee/elephantfish) - 中国象棋引擎
- [sunfish](https://github.com/thomasahle/sunfish) - 基础象棋引擎

## 许可证

本项目遵循GPL License V3，与原项目保持一致。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 项目地址：https://github.com/justLxy/Jieqi

---

祝您游戏愉快！🎮
