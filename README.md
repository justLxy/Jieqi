# 中国暗棋（揭棋）Web版人机对战工具

这是一个基于 Web 的中国暗棋（也称揭棋）人机对战工具。它通过一个简洁直观的网页界面，让您可以随时与集成的 AI 引擎进行对战、复盘和分析。项目前端使用原生 JavaScript 实现，后端由 Flask 驱动，并调用了强大的 `musesfish` 揭棋 AI 引擎。

## ✨ 功能特性

-   **现代化 Web 界面**：无需安装任何客户端，打开浏览器即可开始游戏。
-   **完整揭棋规则**：支持暗子、翻子、吃子、以及相/象、仕/士过河等特殊规则。
-   **强大的 AI 对战**：
    -   可以让人类玩家与 AI 对战。
    -   支持开启**双边 AI**，观察 AI 之间的对局。
-   **AI 辅助功能**：
    -   **走法提示**：随时请求 AI 为当前局面提供最佳走法建议。
    -   **局面评估**：AI 会实时分析当前局势，并给出评估分数。
-   **灵活的棋局控制**：
    -   支持**悔棋**和**重做**。
    -   可以**翻转棋盘**，切换执红或执黑的视角。
-   **暗子身份编辑**：在对局开始前，可以手动指定任意暗子的真实身份，方便进行特定开局或残局的分析和测试。

## 🚀 快速开始

### 环境要求

-   Python 3.7+
-   一个现代浏览器 (推荐使用 Chrome, Firefox, 或 Safari)

### 启动步骤

1.  **克隆或下载项目**

    ```bash
    git clone https://github.com/your-username/Jieqi.git
    cd Jieqi
    ```

2.  **进入 `web` 目录并启动服务器**

    请确保您的工作目录是 `web`，因为服务器需要从此目录启动以正确加载 AI 模块和静态文件。

    ```bash
    cd web
    python app.py
    ```

3.  **开始游戏**

    启动成功后，服务器会监听在 `8000` 端口。打开浏览器并访问：
    [http://127.0.0.1:8000](http://127.0.0.1:8000)

    棋局会自动初始化，红方先行。

## 📖 使用说明

### 棋盘与走子

-   **选择棋子**：点击属于您当前回合的棋子，它的合法移动位置将会高亮显示。
-   **移动棋子**：再次点击高亮的目标格子即可完成移动。
-   **取消选择**：重新点击已选中的棋子即可取消选择。

### AI 功能

-   **获取 AI 提示**：
    -   在右侧的 **AI 控制面板**，点击 "红方AI" 或 "黑方AI" 按钮，即可获取对应方的走法建议。
    -   AI 的推荐走法会以彩色箭头在棋盘上标出，并在右侧面板显示详细信息，如评估分数、搜索深度等。
-   **执行 AI 推荐**：点击 "执行AI推荐" 按钮，棋盘会自动执行 AI 建议的走法。
-   **AI 自动对战**：
    -   打开 "红方 AI" 或 "黑方 AI" 的开关，对应的玩家回合将由 AI 自动走子。
    -   您可以同时打开双方的 AI 开关，观看 AI 之间的对局。

### 暗子处理

揭棋的核心在于暗子。本工具提供了完整的暗子处理机制：

1.  **暗子移动后翻开**：当您移动一个暗子后，右侧面板会自动弹出提示，要求您为这个暗子**指定一个真实身份**。您必须从列表中选择一个尚未达到数量上限的棋子类型。
2.  **吃掉对方的暗子**：当您吃掉对方一个暗子后，您可以知道它是什么。此时，右侧面板同样会提示您为这个**被吃的暗子指定真实身份**。这个信息会被 AI 用来进行更准确的局面评估。
3.  **开局前编辑暗子** (用于测试)：在游戏开始、未走任何棋子之前，您可以**双击棋盘上任意一个暗子**，然后在右侧的棋子类型面板中点击一个棋子，为其手动赋予身份。

### 游戏控制

-   **新游戏**：重置棋盘，开始一局新游戏。
-   **悔棋 / 重做**：在右侧的历史记录面板中，可以点击任意一步来回退或前进到棋局的特定状态。
-   **翻转棋盘**：切换棋盘的显示方向，方便从对手的视角看棋。

## 🛠️ 技术栈

-   **前端**:
    -   HTML5
    -   CSS3 (采用 Grid 布局实现棋盘)
    -   原生 JavaScript (ES6+)，无任何框架依赖。
-   **后端**:
    -   Flask (一个轻量级的 Python Web 框架)。
    -   `musesfish_pvs_20210604_fixed.py` 作为核心 AI 引擎。
-   **前后端通信**:
    -   通过 RESTful API (`/api/...`) 进行 JSON 数据交换。

## 📂 文件结构 (`web` 目录)

```
web/
├── app.py            # Flask 后端服务器，提供 API 接口
├── game.js           # 前端核心逻辑，包含游戏状态管理、UI交互、AI通信等
├── index.html        # 应用主页面 HTML 结构
└── style.css         # 应用的全部 CSS 样式
```

## 🙏 致谢

-   本项目的 AI 引擎基于 `musesfish`，它受到了 [sunfish](https://github.com/thomasahle/sunfish) 和 [elephantfish](https://github.com/bupticybee/elephantfish) 等优秀象棋引擎的启发。
-   感谢所有为中国象棋和揭棋开源项目做出贡献的开发者。
